# Extract Block Events

## Description

The Extract Block Events utility binary can be used to extract a randomized set of transaction events from a protocol state.
Upon start, it will extract the events for a random height within the provided height range from the database.
It will then extract all events of a randomly chosen event type from the event types present in the batch.
The batches will be written to one file each, until the configured total size is reached.

This is useful for the creation of dictionaries that can be used with Zstandard compression.
The default size for a Zstandard dictionary is set to 112,640 bytes, or ~112 kilobytes.
The training command expects a set of compressible payloads as an input, with one payload per file, as generated by this tool.
It is recommended to use at least ten times the size of the dictionary for total input size.
Ideally, a hundred times the size of the dictionary is best, which is what we use as default here.

## Usage

```sh
Usage of extract-block-events:
  -b, --begin uint      lowest block height to include in extraction
  -d, --data string     directory for protocol state database (default "data")
  -f, --finish uint     highest block height to include in extraction (default 100000000)
  -g, --group int       maximum number of events to extract per block (default 10)
  -l, --log string      log level for JSON logger output (default "info")
  -o, --output string   directory for output of black events (default "events")
  -s, --size uint       limit for total size of output files (default 11264000)
```

## Example

The following command will extract up to 20 events for random block heights between height 1,200,000 and 1,500,000.
It will write them to one file each in the `events` directory until the total size has reached ~112 kilobytes

```sh
./extract-block-events -l debug -d /var/flow/data/protocol -b 1200000 -f 1500000 -g 20 -o ./events
```