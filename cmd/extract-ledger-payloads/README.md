# Extract Ledger Payloads

## Description

The Extract Ledger Payloads utility binary can be used to extract a randomized set of ledger payloads from a state trie.
It must be run on top of an execution state, with access to the corresponding protocol state.
Upon start, it will reconstruct the state trie from the checkpoint and the write-ahead log.
Once the final state trie has been reached, it will extract a randomized set of payloads.
The payloads will be written to one file each, until the configured total size is reached.

This is useful for the creation of dictionaries that can be used with Zstandard compression.
The default size for a Zstandard dictionary is set to 112,640 bytes, or ~112 kilobytes.
The training command expects a set of compressable payloads as an input, with one payload per file, as generated by this tool.
It is recommended to use at least ten times the size of the dictionary for total input size.
Ideally, a hundred times the size of the dictionary is best, which is what we use as default here.

## Usage

```sh
Usage of extract-ledger-payloads:
  -c, --checkpoint string   file containing state trie snapshot (default "root.checkpoint")
  -d, --data string         directory for protocol state database (default "data")
  -l, --log string          log level for JSON logger output (default "info")
  -o, --output string       directory for output of ledger payloads (default "payloads")
  -s, --size uint           limit for total size of output files (default 11264000)
  -t, --trie string         directory for execution state database (default "trie")
```

## Example

The following command will output ledger payloads to the `payloads` directory until a total size of ~112 kilobytes has been reached.

```sh
./extract-ledger-payloads -l debug -d /var/flow/data/protocol -t /var/flow/data/execution -c /var/flow/bootstrap/root.checkpoint -o ./payloads
```